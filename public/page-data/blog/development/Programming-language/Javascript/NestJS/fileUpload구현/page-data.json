{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/development/Programming-language/Javascript/NestJS/fileUpload구현/","result":{"data":{"markdownRemark":{"html":"<h1>시작하기 전</h1>\n<p>대학 과제물로 진행하던 프로젝트 (sodi / <a href=\"https://github.com/JangHyuckYun/sodi\">sodi gitub pages</a>) 를 진행하면서\r\n생각보다 많은 에러가 있었다. 그 중에서 초기에 겨우겨우 해결한 것 중 하나가 업로드 관련 부분이다.\r\n적어두지 않으면, 나중에 똑같이 구글링을 계속 하며 찾아볼 거 같아 정리해두기로 했다.</p>\n<h1>1. package.json</h1>\n<p>먼저 NestJS에서 파일 업로드 기능을 사용하기 위해,</p>\n<ol>\n<li>package.json에 <strong>\"@nestjs/platform-express\"</strong>, <strong>\"@types/multer\"</strong> 모듈이 있어야 한다.\n<ol>\n<li>\n<blockquote>\n<p>npm i @nestjs/platform-express<br>\nnpm i -D @types/multer</p>\n</blockquote>\n</li>\n</ol>\n</li>\n</ol>\n<h1>2. Module</h1>\n<p>모듈 데코레이션 안에서, import 배열 안에 <strong>\"MulterModule.registerAsync()\"</strong> 추가</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"typescript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">      MulterModule.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">registerAsync</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">      imports: [ConfigModule],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">      inject: [ConfigService],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">      </span><span class=\"grvsc-tiszgT-10 grvsc-t4tStz-5\">useFactory</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">async</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> (</span><span class=\"grvsc-tiszgT-11 grvsc-t4tStz-1\">config</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">:</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-10 grvsc-t4tStz-5\">ConfigService</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">=&gt;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> ({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">        storage: </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">diskStorage</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">          </span><span class=\"grvsc-tiszgT-10 grvsc-t4tStz-5\">destination</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">function</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> (</span><span class=\"grvsc-tiszgT-11 grvsc-t4tStz-1\">req</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, </span><span class=\"grvsc-tiszgT-11 grvsc-t4tStz-1\">file</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, </span><span class=\"grvsc-tiszgT-11 grvsc-t4tStz-1\">cb</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">// 파일저장위치 + 년월 에다 업로드 파일을 저장한다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">// 요 부분을 원하는 데로 바꾸면 된다.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">// config.get을 사용하여, .env 파일 안에 작성되어 있는 &quot;ATTACH_SAVE_PATH_WINDOW&quot; 변수를</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">// 불러왔다. </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">const</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">dest</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">`${</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">config</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-1\">.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">get</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">(&#39;ATTACH_SAVE_PATH_WINDOW&#39;)}/${</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">format</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">              </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-10\">new</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\"> </span><span class=\"grvsc-tiszgT-10 grvsc-t4tStz-5\">Date</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">              &#39;{yyyy}{MM}&#39;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">            )}/`</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">//자신이 만들고자 하는 파일의 폴더 주소가 없을 경우 생성</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">if</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> (</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">!</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">fs.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">existsSync</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(dest)) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">              fs.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">mkdirSync</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(dest, { recursive: </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">true</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">cb</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, dest);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">          },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">          </span><span class=\"grvsc-tiszgT-10 grvsc-t4tStz-5\">filename</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: (</span><span class=\"grvsc-tiszgT-11 grvsc-t4tStz-1\">req</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, </span><span class=\"grvsc-tiszgT-11 grvsc-t4tStz-1\">file</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, </span><span class=\"grvsc-tiszgT-11 grvsc-t4tStz-1\">cb</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">=&gt;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">// 업로드 후 저장되는 파일명을 랜덤하게 업로드 한다.(동일한 파일명을 업로드 됐을경우 오류방지)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">const</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">randomName</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">Array</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">32</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">              .</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">fill</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">              .</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">map</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(() </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">=&gt;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">Math</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">round</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">Math</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">random</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">() </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">*</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">16</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">).</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">toString</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">16</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">              .</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">join</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">            </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">return</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">cb</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">`${</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-10\">randomName</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">}${</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">extname</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">(</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-10\">file</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">.</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-10\">originalname</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">)}`</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">          },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">        }),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">      }),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  })</span></span></span></code></pre>\n<h1>3. Controller</h1>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"typescript\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  @</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">Post</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;create&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  @</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">UseInterceptors</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">FilesInterceptor</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;files&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  @</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">Bind</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">UploadedFiles</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">())</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  @</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">UseGuards</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(JwtAuthGuard)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">createBoard</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    @</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">UploadedFiles</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">() files: </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">Array</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&lt;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">Express.Multer.File</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&gt;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    @</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">Body</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">() createBoardDto: CreateBoardDto,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    @</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">Req</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">() req,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    createBoardDto.userId </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">Number</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(req?.user?.sub </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">??</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">-</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.boardService.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">createBoard</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(createBoardDto, files);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  }</span></span></span></code></pre>\n<p>컨트롤러에서 <strong>fileUpload</strong> 관련하여 설정할 때 <strong>@UseInterceptors(FilesInterceptor('files'))</strong>,\r\n<strong>@Bind(UploadedFiles())</strong> / 매개변수 안의 <strong>@UploadedFiles() files</strong> 부분이 중요하다.</p>\n<h2>FilesInterceptor(fieldName, maxCount, Options)</h2>\n<p>이 함수는 총 3개의 인자를 갖는다.</p>\n<ol>\n<li>fieldName: 필드 이름으로 HTTP요청 시 파일의 field명</li>\n<li>maxCount: 업로드 시 허용할 수 있는 최대 파일 수</li>\n<li>Options - MulterOptions타입</li>\n</ol>\n<h3>- Options</h3>\n<p>기본적인 업로드 옵션은,</p>\n<ol>\n<li>storage: 저장 방식 설정 ( 디스크, 메모리 )</li>\n<li>fileFilter: 파일 유효성 체크</li>\n<li>limits: 업로드 시 제한 설정</li>\n</ol>\n<p>각 컨틀롤러 함수마다 Options을 지정하면 매우 길어질 수 있다. 이를 방지하고자 공용으로 설정한 부분이, 2번에 설정한 Module 부분이다.\r\n설정하는 방법은 2번에 설명한 것을 참고하면 된다.</p>\n<ol>\n<li>ConfigService를 이용하여 Controller에서 설정하려는 경우 ( .env 값들을 Controller에서 사용하려는 경우 ), 컨트롤러및 해당 모듈에 추가 설정이 필요할 것이다.</li>\n</ol>\n<blockquote>\n<p>파일들을 단일로 업로드 하는 경우,<br>\n@UseInterceptors(FilesInterceptor('files'))의 FilesInterceptor('files') 함수를 => FileInterceptor('file') 함수로,<br>\n@Bind(UploadedFiles())의 UploadedFiles() 함수를 => UploadedFile()함수로,<br>\n매개변수의 @UploadedFiles() files,에서 @UploadedFiles() 데코레이터를 => @UploadedFile() file으로 변경해주면 된다.</p>\n</blockquote>\n<h1>4. Check</h1>\n<p>데코레이터들을 통해 처리되기에, Controller타고 들어와서, 모듈에서 지정한 폴더를 직접 들어가보면 파일이 이미 생성 되있고,\r\nconsole을 찍어보면 파일에 대한 정보가 출력될 것이다. 이 정보를 이용해 db에 넣거나, 개발자가 원하는대로 하면 된다.</p>\n<h1>마치며</h1>\n<p>nestJS를 공부하면서 설정을 하다보니, @UseInterceptors에서, @UploadedFiles() files의 콘솔을 찍으면 값이 안들어오거나,\r\nfiles가 아닌 다른 dto에 파일 값이 들어가지는 등 갖가지 오류를 맛볼 수 있었다. ( 깊이 공부를 안한 탓이다.. )\r\n그래도 직접 맛대며 하다 보니 이제는 대강 흐름을 알 수 있게 되었다.</p>\n<h1>참고자료</h1>\n<ol>\n<li><a href=\"https://docs.nestjs.com/techniques/file-upload\">https://docs.nestjs.com/techniques/file-upload</a></li>\n<li><a href=\"https://any-ting.tistory.com/121\">https://any-ting.tistory.com/121</a></li>\n<li><a href=\"https://velog.io/@yiyb0603/Nest.js%EC%97%90%EC%84%9C-%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C%ED%95%98%EA%B8%B0\">https://velog.io/@yiyb0603/Nest.js%EC%97%90%EC%84%9C-%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C%ED%95%98%EA%B8%B0</a></li>\n<li><a href=\"https://stove99.github.io/nodejs/2021/04/20/nestjs-file-upload/\">https://stove99.github.io/nodejs/2021/04/20/nestjs-file-upload/</a></li>\n<li><a href=\"https://any-ting.tistory.com/121\">https://any-ting.tistory.com/121</a></li>\n</ol>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .github-light-theme {\n    background-color: #ffffff;\n    color: #000000;\n  }\n  .github-light-theme .grvsc-tiszgT-1 { color: #000000; }\n  .github-light-theme .grvsc-tiszgT-7 { color: #005CC5; }\n  .github-light-theme .grvsc-tiszgT-10 { color: #6F42C1; }\n  .github-light-theme .grvsc-tiszgT-5 { color: #D73A49; }\n  .github-light-theme .grvsc-tiszgT-11 { color: #E36209; }\n  .github-light-theme .grvsc-tiszgT-6 { color: #6A737D; }\n  .github-light-theme .grvsc-tiszgT-8 { color: #032F62; }\n  .github-light-theme .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  body[data-theme=dark] .grvsc-ps-t4tStz { color: #ffffff; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-1 { color: #FFFFFF; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-5 { color: #BB97E7; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-9 { color: #EB7E81; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-2 { color: #A19B8F; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-10 { color: #9DCDF5; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-3 { color: #66B5F6; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n</style>","frontmatter":{"title":"NestJS 파일 업로드 설정","desc":"sodi (Let's share our diary lives)프로젝트의 백엔드 부분을 진행하며, 어려웠던 부분에 대해 적어봤습니다.","thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVR42o1RwWrCQBDNj/SHSqH/0HOh9AckghdBRNrUix568NJLchHvwYugFForujGmlF0J1gSaxNik3Z0Ut5uobUN97GHmzb55s7NS8gMASZJ8vNiL8zI+vVx17zPyN6Q8sVO+tY6OyckFMMb5Q8Spfj00yVnRVe7+cwbYlnkMlEEUf3oBULa9kJ2UyXUWYPAHuev8bttYVT0DBbPZ22jkIzTvdLzxmKgaabd9cxrOyULXfcNw+v3AslYYO71etFxuxCHGQ1keVypIUYx6/bnVMhuNV10nmoZuFHR95QwGk2r1sShPm81JrfZQKDyVSmvblnam2gwGjLE43tsCBw3DyHW/L2RVsTBBZY14CpSKf8revL/X1JkxYAx4F0jjJE1FwHuJgNKcbR+ML/4MbeEgvSx9AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/85a9964c200a7af18fdfcabcc5d5c414/87706/nestJsFileUploadLogo.png","srcSet":"/static/85a9964c200a7af18fdfcabcc5d5c414/87706/nestJsFileUploadLogo.png 1280w","sizes":"1280px"},"sources":[{"srcSet":"/static/85a9964c200a7af18fdfcabcc5d5c414/71d4d/nestJsFileUploadLogo.webp 1280w","type":"image/webp","sizes":"1280px"}]},"width":1280,"height":720}}},"date":"2022-11-23","category":"JavaScript"}}},"pageContext":{"slug":"/blog/development/Programming-language/Javascript/NestJS/fileUpload구현/"}},"staticQueryHashes":["1318141210","1840460387","48878111"],"slicesMap":{}}